<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>استعراض الملفات</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
<script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: {
              50: '#eef2ff',
              100: '#e0e7ff',
              200: '#c7d2fe',
              300: '#a5b4fc',
              400: '#818cf8',
              500: '#6366f1',
              600: '#5D5CDE',
              700: '#4338ca',
              800: '#3730a3',
              900: '#312e81',
              950: '#1e1b4b',
            },
            secondary: {
              50: '#f0f9ff',
              100: '#e0f2fe',
              200: '#bae6fd',
              300: '#7dd3fc',
              400: '#38bdf8',
              500: '#0ea5e9',
              600: '#0284c7',
              700: '#0369a1',
              800: '#075985',
              900: '#0c4a6e',
              950: '#082f49',
            },
            accent: {
              50: '#fdf2f8',
              100: '#fce7f3',
              200: '#fbcfe8',
              300: '#f9a8d4',
              400: '#f472b6',
              500: '#ec4899',
              600: '#db2777',
              700: '#be185d',
              800: '#9d174d',
              900: '#831843',
              950: '#500724',
            },
            success: '#10b981',
            warning: '#f59e0b',
            error: '#ef4444',
            dark: {
              background: '#121212',
              surface: '#1e1e1e',
              border: '#2e2e2e'
            }
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-slow': 'bounce 2s infinite',
            'fire': 'fire 1.5s ease-in-out infinite alternate',
            'glow': 'glow 1.5s ease-in-out infinite alternate',
          },
          keyframes: {
            fire: {
              '0%': { boxShadow: '0 0 5px #ff6b6b, 0 0 10px #ff6b6b, 0 0 15px #ff9e6b, 0 0 20px #ffbc6b' },
              '100%': { boxShadow: '0 0 10px #ff6b6b, 0 0 20px #ff6b6b, 0 0 30px #ff9e6b, 0 0 40px #ffbc6b' },
            },
            glow: {
              '0%': { filter: 'brightness(1)' },
              '100%': { filter: 'brightness(1.2)' },
            }
          }
        }
      }
    }
  </script>
<style>
    /* Estilos para el botón de carga */
    .upload-btn {
      position: relative;
      overflow: hidden;
      background: linear-gradient(45deg, #ff3d00, #ff9e00);
      transition: all 0.3s ease;
    }
    
    .upload-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: all 0.6s ease;
    }
    
    .upload-btn:hover::before {
      left: 100%;
    }
    
    .upload-btn:hover {
      transform: translateY(-3px);
    }
    
    .fire-effect {
      animation: fire 1.5s ease-in-out infinite alternate;
    }
    
    .glow-text {
      text-shadow: 0 0 5px rgba(255, 157, 0, 0.7), 0 0 10px rgba(255, 157, 0, 0.5);
      animation: glow 1.5s ease-in-out infinite alternate;
    }
    
    .flames {
      position: absolute;
      bottom: -15px;
      left: 0;
      right: 0;
      height: 15px;
      background-image: 
        radial-gradient(circle at 20% 50%, #ff9d00 0%, transparent 50%),
        radial-gradient(circle at 40% 50%, #ff7300 0%, transparent 50%),
        radial-gradient(circle at 60% 50%, #ff5600 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, #ff3d00 0%, transparent 50%);
      filter: blur(5px);
      opacity: 0.8;
      transform-origin: center bottom;
      animation: flicker 0.5s ease-in-out infinite alternate;
    }
    
    @keyframes flicker {
      0% { transform: scaleX(0.9) scaleY(0.9); opacity: 0.7; }
      100% { transform: scaleX(1.1) scaleY(1.1); opacity: 0.9; }
    }
    
    /* Mejora de apariencia de archivos y carpetas */
    .file-card {
      transition: all 0.3s ease;
    }
    
    .file-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    
    .dark .file-card:hover {
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.5), 0 4px 6px -2px rgba(0, 0, 0, 0.3);
    }
    
    /* Efecto de carga ondulada */
    .ripple-loader {
      position: relative;
    }
    
    .ripple-loader::after {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background-color: rgba(99, 102, 241, 0.3);
      transform: translate(-50%, -50%);
      animation: ripple 1.5s ease-out infinite;
    }
    
    @keyframes ripple {
      0% { width: 0; height: 0; opacity: 1; }
      100% { width: 200px; height: 200px; opacity: 0; }
    }
    
    /* Notificaciones de usuario */
    .custom-notification {
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    /* Mejora para visualización en dispositivos móviles */
    @media (max-width: 640px) {
      .file-card-content {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .file-icon-container {
        margin-bottom: 0.5rem;
        margin-left: 0;
      }

      .breadcrumb-container {
        padding: 0.5rem;
        overflow-x: auto;
        white-space: nowrap;
        -webkit-overflow-scrolling: touch;
      }

      .mobile-full-width {
        width: 100%;
      }
    }

    /* Estilo mejorado para el visualizador de archivos */
    .file-viewer-container {
      backdrop-filter: blur(5px);
      -webkit-backdrop-filter: blur(5px);
      transition: opacity 0.3s ease;
    }

    .file-viewer-content {
      transform: translateY(20px);
      opacity: 0;
      transition: transform 0.3s ease, opacity 0.3s ease;
    }

    .file-viewer-visible .file-viewer-content {
      transform: translateY(0);
      opacity: 1;
    }

    /* Mostrar el camino de navegación */
    #breadcrumb {
      display: flex !important;
      flex-wrap: nowrap;
      overflow-x: auto;
      scrollbar-width: thin;
      padding-bottom: 0.5rem;
    }

    #breadcrumb::-webkit-scrollbar {
      height: 4px;
    }

    #breadcrumb::-webkit-scrollbar-thumb {
      background-color: rgba(156, 163, 175, 0.5);
      border-radius: 2px;
    }

    /* Mejoras visuales adicionales */
    .shimmer {
      position: relative;
      overflow: hidden;
      background: #f6f7f8;
    }
    
    .shimmer::after {
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transform: translateX(-100%);
      background-image: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0,
        rgba(255, 255, 255, 0.2) 20%,
        rgba(255, 255, 255, 0.5) 60%,
        rgba(255, 255, 255, 0)
      );
      animation: shimmer 2s infinite;
      content: '';
    }
    
    @keyframes shimmer {
      100% {
        transform: translateX(100%);
      }
    }

    .dark .shimmer {
      background: #2a2a2a;
    }
    
    .dark .shimmer::after {
      background-image: linear-gradient(
        90deg,
        rgba(40, 40, 40, 0) 0,
        rgba(60, 60, 60, 0.2) 20%,
        rgba(80, 80, 80, 0.5) 60%,
        rgba(40, 40, 40, 0)
      );
    }
  </style>
</head>
<body class="bg-gray-50 text-gray-800 dark:bg-dark-background dark:text-gray-100 min-h-screen transition-colors duration-200 flex flex-col">
<!-- Verificar modo oscuro -->
<script>
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
  </script>
<!-- Encabezado -->
<header class="bg-gradient-to-r from-primary-600 to-secondary-600 text-white shadow-lg dark:from-primary-800 dark:to-secondary-800 sticky top-0 z-10">
<div class="container mx-auto py-4 px-4 sm:py-6">
<div class="flex justify-between items-center">
<h1 class="text-xl md:text-3xl font-bold flex items-center">
<i class="fas fa-folder-open text-yellow-300 mr-3 animate-pulse-slow"></i>
<span class="relative">
            استعراض الملفات
            <span class="absolute -bottom-1 left-0 w-full h-1 bg-yellow-300 rounded-full opacity-70"></span>
</span>
</h1>
<div class="flex items-center space-x-4 space-x-reverse">
<button class="p-2 rounded-full hover:bg-white/20 transition-colors" id="darkModeToggle" aria-label="تبديل الوضع المظلم">
<i class="fas fa-moon text-xl dark:hidden"></i>
<i class="fas fa-sun text-xl hidden dark:block"></i>
</button>
<a class="flex items-center bg-white/20 hover:bg-white/30 px-3 py-2 rounded-lg transition-colors" href="index.html">
<i class="fas fa-home ml-2"></i>
<span class="hidden md:inline">الرئيسية</span>
</a>
</div>
</div>
</div>
</header>
<!-- Ruta de navegación -->
<div class="container mx-auto mt-4 px-4">
<div class="bg-white dark:bg-dark-surface rounded-lg shadow p-3 flex items-center text-sm md:text-base gap-2 breadcrumb-container overflow-x-auto" id="breadcrumb">
<a href="file-browser.html" class="flex items-center text-primary-600 dark:text-primary-400 hover:underline whitespace-nowrap">
<i class="fas fa-home ml-1"></i> الرئيسية
</a>
<!-- JavaScript agregará el resto de la ruta -->
</div>
</div>
<!-- Sección de búsqueda -->
<div class="container mx-auto mt-4 px-4">
<div class="relative">
<div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none">
<i class="fas fa-search text-gray-500 dark:text-gray-400"></i>
</div>
<input class="block w-full p-3 pr-10 text-base text-gray-900 border border-gray-300 rounded-lg bg-white focus:ring-primary-600 focus:border-primary-600 dark:bg-dark-surface dark:border-dark-border dark:placeholder-gray-400 dark:text-white transition-all duration-300" id="searchInput" placeholder="البحث في الملفات الحالية..." type="text"/>
</div>
</div>

<!-- Sección de carga de archivos -->
<div class="container mx-auto mt-4 px-4">
  <!-- Botón de regreso a la página principal -->
  <div class="mb-4">
    <a href="index.html" class="inline-flex items-center px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors">
      <i class="fas fa-arrow-right ml-2"></i>
      <span>الرجوع إلى الرئيسية</span>
    </a>
  </div>

  <!-- Sección de carga de archivos original -->
  <div id="uploadContainer" class="bg-gradient-to-r from-amber-700 to-orange-600 dark:from-amber-900 dark:to-orange-800 rounded-lg shadow-lg p-4 mb-6 relative overflow-hidden">
    <div class="absolute inset-0 bg-black opacity-10 dark:opacity-30"></div>
    <div class="relative z-10">
      <div class="flex items-center mb-3">
        <i class="fas fa-fire text-yellow-300 text-2xl ml-2 glow-text"></i>
        <h3 class="font-bold text-xl text-white glow-text">رفع ملف جديد</h3>
      </div>
      <div class="flex flex-col sm:flex-row gap-3 items-center">
        <div class="relative w-full sm:w-auto">
          <input type="file" id="uploadInput" class="opacity-0 absolute inset-0 w-full h-full cursor-pointer z-20" multiple/>
          <div class="bg-white/20 text-white px-4 py-2 rounded-lg flex items-center justify-center w-full">
            <i class="fas fa-file-upload ml-2"></i>
            <span>اختر ملفات</span>
          </div>
          <p id="fileNameDisplay" class="text-sm text-white/80 mt-1 h-5 overflow-hidden whitespace-nowrap overflow-ellipsis max-w-xs"></p>
        </div>
        <button onclick="uploadFileToCurrent()" id="uploadButton" class="upload-btn text-white px-6 py-3 rounded-lg font-bold flex items-center justify-center relative fire-effect overflow-hidden w-full sm:w-auto">
          <i class="fas fa-cloud-upload-alt ml-2"></i>
          <span>رفع إلى هذا المجلد</span>
          <div class="flames"></div>
        </button>
      </div>
      <p class="text-xs text-white/70 mt-3">الملفات المدعومة: doc, docx, pdf, ppt, pptx, xls, xlsx, txt, jpg, png, zip</p>
    </div>
  </div>
</div>

<!-- Contenido principal -->
<main class="container mx-auto mt-2 px-4 pb-12 flex-grow">
<!-- Estado de carga -->
<div class="flex flex-col items-center justify-center py-16 ripple-loader" id="loadingState">
<div class="w-16 h-16 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"></div>
<p class="mt-4 text-gray-600 dark:text-gray-300">جاري تحميل الملفات...</p>
</div>
<!-- Lista de archivos -->
<div class="hidden" id="fileContent">
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4" id="fileGrid">
<!-- JavaScript agregará los archivos aquí -->
</div>
</div>
<!-- Mensaje cuando no hay archivos -->
<div class="hidden flex flex-col items-center justify-center py-16 text-center" id="emptyMessage">
<div class="text-6xl mb-4 text-gray-400 dark:text-gray-600">
<i class="fas fa-folder-open"></i>
</div>
<h2 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">المجلد فارغ</h2>
<p class="text-gray-500 dark:text-gray-400 max-w-md">لا توجد ملفات في هذا المجلد. يمكنك رفع ملفات جديدة باستخدام زر الرفع أعلاه.</p>
</div>
<!-- Mensaje de error -->
<div class="hidden flex flex-col items-center justify-center py-16 text-center" id="errorMessage">
<div class="text-6xl mb-4 text-error">
<i class="fas fa-exclamation-triangle"></i>
</div>
<h2 class="text-xl font-bold text-gray-700 dark:text-gray-300 mb-2">حدث خطأ</h2>
<p class="text-gray-500 dark:text-gray-400 max-w-md">تعذر تحميل محتوى هذا المجلد. يرجى المحاولة مرة أخرى لاحقًا.</p>
<button class="mt-4 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors" id="retryButton">
<i class="fas fa-redo ml-1"></i>إعادة المحاولة
      </button>
</div>
<!-- Modal de vista previa de archivo -->
<div class="fixed inset-0 bg-black/70 dark:bg-black/80 z-50 flex items-center justify-center hidden file-viewer-container" id="fileViewerModal">
<div class="relative bg-white dark:bg-dark-surface rounded-lg shadow-xl max-w-3xl w-full max-h-[90vh] overflow-hidden file-viewer-content">
<div class="flex justify-between items-center p-4 border-b dark:border-dark-border">
<h3 class="font-bold text-lg truncate" id="fileViewerTitle"></h3>
<button class="text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200" id="closeFileViewer" aria-label="إغلاق">
<i class="fas fa-times text-xl"></i>
</button>
</div>
<div class="p-4 overflow-auto max-h-[calc(90vh-80px)]" id="fileViewerContent">
<!-- JavaScript agregará el contenido del archivo aquí -->
</div>
<div class="p-4 border-t dark:border-dark-border flex justify-end">
<a class="bg-primary-600 hover:bg-primary-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center" download="" href="#" id="downloadFileLink">
<i class="fas fa-download ml-1"></i>تحميل الملف
          </a>
</div>
</div>
</div>
</main>
<!-- Pie de página -->
<footer class="bg-white dark:bg-dark-surface border-t dark:border-dark-border py-4">
<div class="container mx-auto px-4 text-center">
<p class="text-gray-600 dark:text-gray-400">© 2025 منصة التعليم الجزائري - جميع الحقوق محفوظة</p>
</div>
</footer>
<!-- Guía de iconos -->
<div class="fixed bottom-4 right-4 z-40" id="iconGuide">
<button class="bg-primary-600 hover:bg-primary-700 text-white p-3 rounded-full shadow-lg transition-transform hover:scale-110 focus:outline-none focus:ring-2 focus:ring-primary-400 dark:focus:ring-primary-600" aria-label="دليل الأيقونات">
<i class="fas fa-question"></i>
</button>
<div class="absolute bottom-full right-0 mb-2 w-64 p-4 bg-white dark:bg-dark-surface rounded-lg shadow-xl hidden transition-opacity" id="iconGuideContent">
<h3 class="font-bold mb-2 border-b pb-1 dark:border-dark-border">دليل الأيقونات</h3>
<ul class="text-sm space-y-2">
<li class="flex items-center"><i class="fas fa-folder text-yellow-500 ml-2"></i> مجلد</li>
<li class="flex items-center"><i class="fas fa-file-pdf text-red-500 ml-2"></i> ملف PDF</li>
<li class="flex items-center"><i class="fas fa-file-word text-blue-500 ml-2"></i> ملف Word</li>
<li class="flex items-center"><i class="fas fa-file-excel text-green-500 ml-2"></i> ملف Excel</li>
<li class="flex items-center"><i class="fas fa-file-powerpoint text-orange-500 ml-2"></i> ملف PowerPoint</li>
<li class="flex items-center"><i class="fas fa-file-image text-purple-500 ml-2"></i> صورة</li>
<li class="flex items-center"><i class="fas fa-file-alt text-gray-500 ml-2"></i> ملف نصي</li>
<li class="flex items-center"><i class="fas fa-file-archive text-amber-600 ml-2"></i> ملف مضغوط</li>
<li class="flex items-center"><i class="fas fa-file text-gray-400 ml-2"></i> ملف آخر</li>
</ul>
</div>
</div>
<script>
    // Variables de inicialización
    const username = "linnkou";
    const repo = "majani";
    const branch = "main";

    // Obtener la ruta
    const params = new URLSearchParams(window.location.search);
    const path = params.get("path") || "";
    
    // Identificar elementos DOM
    const breadcrumb = document.getElementById("breadcrumb");
    const loadingState = document.getElementById("loadingState");
    const fileContent = document.getElementById("fileContent");
    const fileGrid = document.getElementById("fileGrid");
    const emptyMessage = document.getElementById("emptyMessage");
    const errorMessage = document.getElementById("errorMessage");
    const searchInput = document.getElementById("searchInput");
    const iconGuideButton = document.querySelector("#iconGuide button");
    const iconGuideContent = document.getElementById("iconGuideContent");
    const retryButton = document.getElementById("retryButton");
    const darkModeToggle = document.getElementById("darkModeToggle");
    const uploadInput = document.getElementById("uploadInput");
    const fileNameDisplay = document.getElementById("fileNameDisplay");
    const uploadButton = document.getElementById("uploadButton");
    
    // Elementos DOM para el modal
    const fileViewerModal = document.getElementById("fileViewerModal");
    const fileViewerTitle = document.getElementById("fileViewerTitle");
    const fileViewerContent = document.getElementById("fileViewerContent");
    const closeFileViewer = document.getElementById("closeFileViewer");
    const downloadFileLink = document.getElementById("downloadFileLink");

    // Almacenar datos de archivos y carpetas
    let filesData = [];
    let virtualFiles = []; // Para archivos simulados desde localStorage

    // Función para verificar el estado de inicio de sesión
    function isUserLoggedIn() {
      const user = JSON.parse(localStorage.getItem("currentUser") || "null");
      return user !== null;
    }

    // Función para obtener la ruta actual
    function getCurrentPath() {
      return path || "";
    }

    // Función para cargar archivos
    function uploadFileToCurrent() {
      const files = uploadInput.files;
      if (!files || files.length === 0) {
        showNotification("يرجى اختيار ملف أولاً", "error");
        return;
      }
      
      const user = JSON.parse(localStorage.getItem("currentUser") || "null");
      if (!user) {
        showNotification("يرجى تسجيل الدخول أولاً", "error");
        return;
      }

      // Verificar extensiones de archivo
      const validExtensions = ['.doc', '.docx', '.pdf', '.ppt', '.pptx', '.xls', '.xlsx', '.txt', '.jpg', '.jpeg', '.png', '.zip'];
      let invalidFiles = [];
      
      // Mostrar efecto de carga en el botón
      uploadButton.classList.add("opacity-70", "cursor-wait");
      uploadButton.innerHTML = '<i class="fas fa-spinner fa-spin ml-2"></i> جاري الرفع...';
      
      // Almacenar archivos
      const storedFiles = JSON.parse(localStorage.getItem("browserFiles") || "[]");
      let filesUploaded = 0;
      
      Array.from(files).forEach(file => {
        const fileExt = '.' + file.name.split('.').pop().toLowerCase();
        
        if (!validExtensions.includes(fileExt)) {
          invalidFiles.push(file.name);
          return;
        }
        
        storedFiles.push({
          name: file.name,
          path: getCurrentPath(),
          approved: false,
          uploadedBy: user.username,
          timestamp: new Date().toISOString(),
          size: file.size
        });
        
        filesUploaded++;
      });
      
      // Mostrar mensaje de error si hay archivos inválidos
      if (invalidFiles.length > 0) {
        showNotification(`الملفات التالية غير مدعومة: ${invalidFiles.join(', ')}`, "warning");
      }
      
      // Guardar archivos y mostrar mensaje de éxito
      if (filesUploaded > 0) {
        localStorage.setItem("browserFiles", JSON.stringify(storedFiles));
        
        // Mostrar mensaje de éxito
        setTimeout(() => {
          uploadButton.classList.remove("opacity-70", "cursor-wait");
          uploadButton.innerHTML = '<i class="fas fa-cloud-upload-alt ml-2"></i><span>رفع إلى هذا المجلد</span><div class="flames"></div>';
          
          const successMsg = filesUploaded === 1 
            ? "✅ تم رفع الملف بنجاح! بانتظار موافقة الأدمن."
            : `✅ تم رفع ${filesUploaded} ملفات بنجاح! بانتظار موافقة الأدمن.`;
          
          showNotification(successMsg, "success");
          
          // Restablecer campo de entrada
          uploadInput.value = "";
          fileNameDisplay.textContent = "";
          
          // Actualizar visualización de archivos pendientes
          displayPendingFiles();
        }, 1500);
      } else if (invalidFiles.length === files.length) {
        // Todos los archivos son inválidos
        uploadButton.classList.remove("opacity-70", "cursor-wait");
        uploadButton.innerHTML = '<i class="fas fa-cloud-upload-alt ml-2"></i><span>رفع إلى هذا المجلد</span><div class="flames"></div>';
      }
    }

    // Mostrar notificación al usuario
    function showNotification(message, type = "info") {
      // Eliminar notificaciones anteriores
      const existingNotifications = document.querySelectorAll('.custom-notification');
      existingNotifications.forEach(notification => {
        notification.remove();
      });
      
      // Crear elemento de notificación
      const notification = document.createElement('div');
      notification.className = 'custom-notification fixed top-4 left-1/2 transform -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg z-50 flex items-center';
      
      // Establecer colores según el tipo
      let icon, bgColor, textColor;
      switch(type) {
        case 'success':
          icon = 'fa-check-circle';
          bgColor = 'bg-green-600';
          textColor = 'text-white';
          break;
        case 'error':
          icon = 'fa-exclamation-circle';
          bgColor = 'bg-red-600';
          textColor = 'text-white';
          break;
        case 'warning':
          icon = 'fa-exclamation-triangle';
          bgColor = 'bg-yellow-500';
          textColor = 'text-white';
          break;
        default:
          icon = 'fa-info-circle';
          bgColor = 'bg-blue-600';
          textColor = 'text-white';
      }
      
      notification.classList.add(bgColor, textColor);
      notification.innerHTML = `
        <i class="fas ${icon} ml-2"></i>
        <span>${message}</span>
      `;
      
      // Agregar notificación a la página
      document.body.appendChild(notification);
      
      // Efecto de aparición de la notificación
      setTimeout(() => {
        notification.style.opacity = '1';
      }, 10);
      
      // Eliminar notificación después de 3 segundos
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          notification.remove();
        }, 300);
      }, 3000);
    }

    // Mostrar archivos pendientes de aprobación
    function displayPendingFiles() {
      const storedFiles = JSON.parse(localStorage.getItem("browserFiles") || "[]");
      const currentPathFiles = storedFiles.filter(file => file.path === getCurrentPath() && !file.approved);
      
      // Eliminar sección de archivos pendientes si existe
      const existingPendingSection = document.getElementById("pendingFilesSection");
      if (existingPendingSection) {
        existingPendingSection.remove();
      }
      
      // Si hay archivos pendientes, crear una nueva sección para ellos
      if (currentPathFiles.length > 0) {
        const pendingSection = document.createElement("div");
        pendingSection.id = "pendingFilesSection";
        pendingSection.className = "container mx-auto mt-6 px-4 mb-6";
        pendingSection.innerHTML = `
          <div class="bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg p-4">
            <h3 class="text-lg font-bold text-yellow-800 dark:text-yellow-300 mb-3 flex items-center">
              <i class="fas fa-clock mr-2"></i>
              ملفات بانتظار الموافقة (${currentPathFiles.length})
            </h3>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3" id="pendingFilesList">
              ${currentPathFiles.map(file => `
                <div class="bg-white dark:bg-dark-surface border border-yellow-200 dark:border-yellow-800/50 rounded-lg p-3 flex items-center file-card">
                  <div class="${getFileIconAndColors({name: file.name, type: 'file'}).textColor} ml-3">
                    <i class="${getFileIconAndColors({name: file.name, type: 'file'}).icon} text-2xl"></i>
                  </div>
                  <div class="flex-1 overflow-hidden">
                    <h4 class="font-medium text-gray-800 dark:text-gray-200 truncate" title="${file.name}">${file.name || 'ملف بدون اسم'}</h4>
                   <p class="text-xs text-gray-500 dark:text-gray-400">
                     تم الرفع منذ ${getTimeAgo(file.timestamp)}
                     <span class="bg-yellow-100 dark:bg-yellow-800/50 text-yellow-800 dark:text-yellow-300 text-xs px-2 py-0.5 rounded mr-1">قيد الانتظار</span>
                   </p>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        `;
        
        // Agregar sección antes de la sección de contenido principal
        document.querySelector("main").insertBefore(pendingSection, loadingState);
      }
    }

    // Función para obtener el tiempo transcurrido desde una fecha
    function getTimeAgo(timestamp) {
      const now = new Date();
      const date = new Date(timestamp);
      const diffInSeconds = Math.floor((now - date) / 1000);
      
      if (diffInSeconds < 60) {
        return "لحظات";
      } else if (diffInSeconds < 3600) {
        const minutes = Math.floor(diffInSeconds / 60);
        return minutes + (minutes === 1 ? " دقيقة" : " دقائق");
      } else if (diffInSeconds < 86400) {
        const hours = Math.floor(diffInSeconds / 3600);
        return hours + (hours === 1 ? " ساعة" : " ساعات");
      } else if (diffInSeconds < 2592000) {
        const days = Math.floor(diffInSeconds / 86400);
        return days + (days === 1 ? " يوم" : " أيام");
      } else if (diffInSeconds < 31536000) {
        const months = Math.floor(diffInSeconds / 2592000);
        return months + (months === 1 ? " شهر" : " أشهر");
      } else {
        const years = Math.floor(diffInSeconds / 31536000);
        return years + (years === 1 ? " سنة" : " سنوات");
      }
    }

    // Cargar archivos desde la API de GitHub
    function loadFiles() {
      // Mostrar estado de carga
      loadingState.classList.remove("hidden");
      fileContent.classList.add("hidden");
      emptyMessage.classList.add("hidden");
      errorMessage.classList.add("hidden");

      // Preparar ruta de API
      const fullPath = "educationdzwordland/" + path;
      const encodedPath = fullPath.split("/").map(encodeURIComponent).join("/");
      const apiUrl = `https://api.github.com/repos/${username}/${repo}/contents/${encodedPath}?ref=${branch}`;

      // Preparar ruta de navegación (breadcrumb)
      buildBreadcrumb();

      // Obtener datos
      fetch(apiUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error(`استجابة غير ناجحة: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          // Ocultar estado de carga
          loadingState.classList.add("hidden");
          
          if (!Array.isArray(data)) {
            // Si la respuesta no es un array, significa que es un solo archivo
            handleSingleFile(data);
            return;
          }

          // Filtrar y almacenar archivos
          // IMPORTANTE: Ahora procesamos todos los archivos, incluso los que comienzan con punto
          filesData = data;
          
          // Crear elementos virtuales para archivos locales aprobados
          addVirtualFiles();

          if (filesData.length === 0 && virtualFiles.length === 0) {
            emptyMessage.classList.remove("hidden");
            return;
          }

          // Mostrar contenido
          fileContent.classList.remove("hidden");
          
          // Ordenar elementos: carpetas primero, luego archivos, ambos alfabéticamente
          const allFiles = [...filesData, ...virtualFiles].sort((a, b) => {
            if (a.type !== b.type) {
              return a.type === "dir" ? -1 : 1;
            }
            return a.name.localeCompare(b.name);
          });

          // Mostrar archivos
          renderFiles(allFiles);

          // Agregar manejador de búsqueda
          setupSearch();
          
          // Mostrar archivos pendientes de aprobación
          displayPendingFiles();
        })
        .catch(error => {
          loadingState.classList.add("hidden");
          errorMessage.classList.remove("hidden");
          console.error("Error al cargar archivos:", error);
        });
    }

    // Agregar archivos virtuales desde localStorage
    function addVirtualFiles() {
      // Obtener archivos almacenados
      const storedFiles = JSON.parse(localStorage.getItem("browserFiles") || "[]");
      
      // Filtrar archivos aprobados en la ruta actual
      const approvedFiles = storedFiles.filter(file => 
        file.path === getCurrentPath() && file.approved === true
      );
      
      // Convertir a formato compatible con la API
      virtualFiles = approvedFiles.map(file => ({
        name: file.name || 'unnamed_file' + (file.name ? file.name.substring(file.name.lastIndexOf('.')) : ''),
        type: 'file',
        size: file.size || 0,
        path: file.path,
        created_at: file.timestamp,
        last_modified: file.timestamp,
        virtual: true, // Marcar como archivo virtual
        download_url: '#', // URL ficticia
      }));
    }

    // Función para crear ruta de navegación (breadcrumb)
    function buildBreadcrumb() {
      // Limpiar contenido anterior
      breadcrumb.innerHTML = `
        <a href="file-browser.html" class="flex items-center text-primary-600 dark:text-primary-400 hover:underline">
          <i class="fas fa-home ml-1"></i> الرئيسية
        </a>
      `;
      
      if (path) {
        const segments = path.split('/');
        let currentPath = '';
        
        segments.forEach((segment, index) => {
          if (!segment) return;
          
          currentPath += segment;
          
          const divider = document.createElement('span');
          divider.textContent = '/';
          divider.className = 'text-gray-400 mx-1';
          breadcrumb.appendChild(divider);
          
          const link = document.createElement('a');
          link.href = `file-browser.html?path=${currentPath}`;
          link.className = index === segments.length - 1 
            ? 'text-gray-800 dark:text-gray-200 font-medium' 
            : 'text-primary-600 dark:text-primary-400 hover:underline';
          link.textContent = segment;
          breadcrumb.appendChild(link);
          
          currentPath += '/';
        });
      }
    }

    // Función para mostrar archivos y carpetas
    function renderFiles(files) {
      fileGrid.innerHTML = '';
      
      files.forEach(item => {
        const { icon, textColor, bgColor } = getFileIconAndColors(item);
        
        const card = document.createElement('div');
        card.className = 'bg-white dark:bg-dark-surface border border-gray-200 dark:border-dark-border rounded-lg overflow-hidden file-card hover:border-primary-400 dark:hover:border-primary-600 transition-all shadow-sm hover:shadow';
        
        const isDirectory = item.type === 'dir';
        const dateModified = new Date(item.last_modified || item.created_at || new Date());
        const fileName = item.name || 'ملف بدون اسم';
        
        card.innerHTML = `
          <div class="flex items-center p-4 file-card-content">
            <div class="${bgColor} w-10 h-10 flex items-center justify-center rounded-lg ml-3 file-icon-container">
              <i class="fas ${icon} ${textColor} text-xl"></i>
            </div>
            <div class="flex-grow min-w-0">
              <h3 class="font-medium text-gray-800 dark:text-gray-200 truncate" title="${fileName}">${fileName}</h3>
              <p class="text-xs text-gray-500 dark:text-gray-400">
                ${isDirectory ? 'مجلد' : formatFileSize(item.size)}
                <span class="mx-1">•</span>
                ${formatDate(dateModified)}
              </p>
            </div>
          </div>
          <div class="bg-gray-50 dark:bg-dark-surface border-t dark:border-dark-border px-4 py-2 flex justify-end">
            ${isDirectory ? 
              `<a href="file-browser.html?path=${path ? path + '/' : ''}${item.name}" class="text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300 flex items-center text-sm">
                <span>فتح</span>
                <i class="fas fa-chevron-left mr-1"></i>
              </a>` : 
              `<button class="text-primary-600 hover:text-primary-800 dark:text-primary-400 dark:hover:text-primary-300 flex items-center text-sm view-file-btn" data-filename="${fileName}" data-download-url="${item.download_url || '#'}" data-virtual="${item.virtual || false}">
                <span>عرض</span>
                <i class="fas fa-eye mr-1"></i>
              </button>`
            }
          </div>
        `;
        
        fileGrid.appendChild(card);
      });
      
      // Agregar eventos de clic a los botones de vista previa
      document.querySelectorAll('.view-file-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const fileName = btn.getAttribute('data-filename');
          const downloadUrl = btn.getAttribute('data-download-url');
          const isVirtual = btn.getAttribute('data-virtual') === 'true';
          
          if (isVirtual) {
            showNotification("هذا ملف محلي ولا يمكن عرضه. يرجى تحميله أولاً.", "info");
          } else {
            viewFile({ name: fileName, download_url: downloadUrl });
          }
        });
      });
    }

    // Función para formatear tamaño de archivo
    function formatFileSize(bytes) {
      if (!bytes) return 'غير معروف';
      if (bytes === 0) return '0 بايت';
      
      const sizes = ['بايت', 'كيلوبايت', 'ميجابايت', 'جيجابايت', 'تيرابايت'];
      const i = Math.floor(Math.log(bytes) / Math.log(1024));
      
      return parseFloat((bytes / Math.pow(1024, i)).toFixed(2)) + ' ' + sizes[i];
    }

    // Función para formatear fecha
    function formatDate(date) {
      return date.toLocaleDateString('ar-SA', {
        year: 'numeric',
        month: 'short',
        day: 'numeric'
      });
    }

    // Función para obtener icono y colores de archivo apropiados
    function getFileIconAndColors(item) {
      let icon = 'fa-file';
      let textColor = 'text-gray-400';
      let bgColor = 'bg-gray-100 dark:bg-gray-800';
      
      if (item.type === 'dir') {
        icon = 'fa-folder';
        textColor = 'text-yellow-500';
        bgColor = 'bg-yellow-100 dark:bg-yellow-900/30';
      } else if (item.name) {
        // Extraer extensión incluso si el nombre comienza con punto
        let ext = '';
        const nameParts = item.name.split('.');
        if (nameParts.length > 1) {
          ext = nameParts[nameParts.length - 1].toLowerCase();
        } else if (item.name.startsWith('.')) {
          ext = item.name.substring(1);
        }
        
        if (['pdf'].includes(ext)) {
          icon = 'fa-file-pdf';
          textColor = 'text-red-500';
          bgColor = 'bg-red-100 dark:bg-red-900/30';
        } else if (['doc', 'docx'].includes(ext)) {
          icon = 'fa-file-word';
          textColor = 'text-blue-500';
          bgColor = 'bg-blue-100 dark:bg-blue-900/30';
        } else if (['xls', 'xlsx'].includes(ext)) {
          icon = 'fa-file-excel';
          textColor = 'text-green-500';
          bgColor = 'bg-green-100 dark:bg-green-900/30';
        } else if (['ppt', 'pptx'].includes(ext)) {
          icon = 'fa-file-powerpoint';
          textColor = 'text-orange-500';
          bgColor = 'bg-orange-100 dark:bg-orange-900/30';
        } else if (['jpg', 'jpeg', 'png', 'gif', 'svg'].includes(ext)) {
          icon = 'fa-file-image';
          textColor = 'text-purple-500';
          bgColor = 'bg-purple-100 dark:bg-purple-900/30';
        } else if (['txt', 'md'].includes(ext)) {
          icon = 'fa-file-alt';
          textColor = 'text-gray-500';
          bgColor = 'bg-gray-100 dark:bg-gray-800';
        } else if (['zip', 'rar', '7z'].includes(ext)) {
          icon = 'fa-file-archive';
          textColor = 'text-amber-600';
          bgColor = 'bg-amber-100 dark:bg-amber-900/30';
        }
      }
      
      return { icon, textColor, bgColor };
    }

    // Procesar un solo archivo (mostrar modal)
    function handleSingleFile(file) {
      showFileViewer(file);
    }

    // Configurar función de búsqueda
    function setupSearch() {
      searchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        
        if (query === '') {
          renderFiles([...filesData, ...virtualFiles]);
          return;
        }
        
        const filteredFiles = [...filesData, ...virtualFiles].filter(item => 
          (item.name || '').toLowerCase().includes(query)
        );
        
        if (filteredFiles.length === 0) {
          fileGrid.innerHTML = `
            <div class="col-span-full text-center py-8">
              <div class="text-4xl mb-3 text-gray-400 dark:text-gray-600">
                <i class="fas fa-search"></i>
              </div>
              <h3 class="text-lg font-medium text-gray-700 dark:text-gray-300 mb-1">لا توجد نتائج مطابقة</h3>
              <p class="text-gray-500 dark:text-gray-400">لم يتم العثور على ملفات أو مجلدات تطابق كلمة البحث "${query}"</p>
            </div>
          `;
        } else {
          renderFiles(filteredFiles);
        }
      });
    }

    // Mostrar modal de vista previa de archivo
    function viewFile(item) {
      // Establecer título del archivo
      fileViewerTitle.textContent = item.name || 'ملف بدون اسم';
      
      // Establecer enlace de descarga
      downloadFileLink.href = item.download_url;
      downloadFileLink.setAttribute('download', item.name || 'download');
      
      // Establecer contenido del visor según el tipo de archivo
      setFileViewerContent(item);
      
      // Mostrar modal con animación
      fileViewerModal.classList.remove('hidden');
      setTimeout(() => {
        fileViewerModal.classList.add('file-viewer-visible');
      }, 10);
      
      // Prevenir desplazamiento en la página principal
      document.body.style.overflow = 'hidden';
    }

    // Establecer contenido del visor de archivos según el tipo de archivo
    function setFileViewerContent(item) {
      // Limpiar contenido anterior
      fileViewerContent.innerHTML = '';
      
      // Mostrar estado de carga
      fileViewerContent.innerHTML = `
        <div class="flex flex-col items-center justify-center py-8">
          <div class="w-12 h-12 border-4 border-primary-600 border-t-transparent rounded-full animate-spin"></div>
          <p class="mt-4 text-gray-600 dark:text-gray-300">جاري تحميل محتوى الملف...</p>
        </div>
      `;
      
      // Extraer extensión incluso si el nombre comienza con punto
      let extension = '';
      const nameParts = (item.name || '').split('.');
      if (nameParts.length > 1) {
        extension = nameParts[nameParts.length - 1].toLowerCase();
      } else if (item.name && item.name.startsWith('.')) {
        extension = item.name.substring(1);
      }
      
      // Mostrar archivo según su tipo
      if (['jpg', 'jpeg', 'png', 'gif'].includes(extension)) {
        // Imágenes
        const img = document.createElement('img');
        img.src = item.download_url;
        img.className = 'max-w-full h-auto mx-auto rounded-lg';
        img.alt = item.name || 'صورة';
        
        img.onload = () => {
          fileViewerContent.innerHTML = '';
          fileViewerContent.appendChild(img);
        };
        
        img.onerror = () => {
          fileViewerContent.innerHTML = `
            <div class="text-center py-8">
              <div class="text-4xl mb-4 text-error">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <p>تعذر تحميل الصورة. يرجى تجربة تحميل الملف مباشرة.</p>
            </div>
          `;
        };
      } else if (['pdf'].includes(extension)) {
        // Archivos PDF
        fileViewerContent.innerHTML = `
          <div class="flex flex-col h-[500px]">
            <iframe src="${item.download_url}" class="w-full h-full rounded border dark:border-dark-border"></iframe>
          </div>
        `;
      } else if (['txt', 'md', 'json', 'xml', 'csv', 'html', 'css', 'js'].includes(extension)) {
        // Archivos de texto
        fetch(item.download_url)
          .then(response => response.text())
          .then(text => {
            fileViewerContent.innerHTML = `
              <pre class="bg-gray-100 dark:bg-gray-800 p-4 rounded overflow-x-auto whitespace-pre-wrap">${escapeHtml(text)}</pre>
            `;
          })
          .catch(() => {
            fileViewerContent.innerHTML = `
              <div class="text-center py-8">
                <div class="text-4xl mb-4 text-error">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p>تعذر تحميل محتوى الملف. يرجى تجربة تحميل الملف مباشرة.</p>
              </div>
            `;
          });
      } else if (['.gitignore', '.gitattributes', '.env'].includes(item.name)) {
        // Archivos de configuración de Git/entorno
        fetch(item.download_url)
          .then(response => response.text())
          .then(text => {
            fileViewerContent.innerHTML = `
              <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded">
                <div class="mb-2 text-sm text-gray-500 dark:text-gray-400">ملف تكوين: ${item.name}</div>
                <pre class="overflow-x-auto whitespace-pre-wrap">${escapeHtml(text)}</pre>
              </div>
            `;
          })
          .catch(() => {
            fileViewerContent.innerHTML = `
              <div class="text-center py-8">
                <div class="text-4xl mb-4 text-error">
                  <i class="fas fa-exclamation-triangle"></i>
                </div>
                <p>تعذر تحميل محتوى الملف. يرجى تجربة تحميل الملف مباشرة.</p>
              </div>
            `;
          });
      } else {
        // Otros tipos de archivo
        fileViewerContent.innerHTML = `
          <div class="text-center py-8">
            <div class="text-6xl mb-4 ${getFileIconAndColors(item).textColor}">
              <i class="${getFileIconAndColors(item).icon}"></i>
            </div>
            <p class="text-xl font-bold mb-2">${item.name || 'ملف'}</p>
            <p class="mb-4">هذا النوع من الملفات لا يمكن عرضه مباشرة. يرجى تحميل الملف لعرضه.</p>
            <div class="bg-gray-100 dark:bg-gray-800 p-3 rounded-lg text-left inline-block">
              <p class="font-medium mb-1">معلومات الملف:</p>
              <ul class="text-sm space-y-1">
                <li><span class="font-medium ml-1">النوع:</span> ${extension || 'غير معروف'}</li>
                <li><span class="font-medium ml-1">الحجم:</span> ${formatFileSize(item.size)}</li>
              </ul>
            </div>
          </div>
        `;
      }
    }

    // Escapar texto HTML
    function escapeHtml(text) {
      return text
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
    }

    // Configurar manejadores de eventos
    function setupEventListeners() {
      // Botón de reintento
      retryButton.addEventListener('click', loadFiles);
      
      // Botón de alternancia de modo oscuro
      darkModeToggle.addEventListener('click', () => {
        document.documentElement.classList.toggle('dark');
        localStorage.setItem('color-theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
      });
      
      // Guía de iconos
      iconGuideButton.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();
        iconGuideContent.classList.toggle('hidden');
      });
      
      // Ocultar guía de iconos al hacer clic fuera
      document.addEventListener('click', (e) => {
        if (!iconGuide.contains(e.target)) {
          iconGuideContent.classList.add('hidden');
        }
      });
      
      // Cerrar modal de visor de archivos
      closeFileViewer.addEventListener('click', () => {
        fileViewerModal.classList.remove('file-viewer-visible');
        setTimeout(() => {
          fileViewerModal.classList.add('hidden');
          document.body.style.overflow = 'auto';
        }, 300);
      });
      
      // Cerrar modal al hacer clic fuera del contenido
      fileViewerModal.addEventListener('click', (e) => {
        if (e.target === fileViewerModal) {
          fileViewerModal.classList.remove('file-viewer-visible');
          setTimeout(() => {
            fileViewerModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
          }, 300);
        }
      });
      
      // Cerrar modal con tecla Escape
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && !fileViewerModal.classList.contains('hidden')) {
          fileViewerModal.classList.remove('file-viewer-visible');
          setTimeout(() => {
            fileViewerModal.classList.add('hidden');
            document.body.style.overflow = 'auto';
          }, 300);
        }
      });
      
      // Actualizar visualización de nombre de archivo al seleccionarlo
      uploadInput.addEventListener('change', () => {
        const files = uploadInput.files;
        if (files.length > 0) {
          fileNameDisplay.textContent = files.length === 1 
            ? files[0].name
            : `تم اختيار ${files.length} ملفات`;
        } else {
          fileNameDisplay.textContent = '';
        }
      });
      
      // Optimizaciones para dispositivos móviles
      if (window.innerWidth < 768) {
        document.querySelectorAll('.file-card-content').forEach(card => {
          card.classList.add('mobile-styling');
        });
      }
      
      // Ajustar diseño en cambio de tamaño de ventana
      window.addEventListener('resize', () => {
        if (window.innerWidth < 768) {
          document.querySelectorAll('.file-card-content').forEach(card => {
            card.classList.add('mobile-styling');
          });
        } else {
          document.querySelectorAll('.file-card-content').forEach(card => {
            card.classList.remove('mobile-styling');
          });
        }
      });
    }

    // Cerrar sesión
    function logoutUser() {
      localStorage.removeItem("currentUser");
      window.location.href = "login.html";
    }

    // Inicializar página
    document.addEventListener('DOMContentLoaded', () => {
      // Verificar inicio de sesión
      const currentUser = JSON.parse(localStorage.getItem("currentUser") || "null");
      const users = JSON.parse(localStorage.getItem("users") || "[]");
      const found = currentUser ? users.find(u => u.username === currentUser.username && u.password === currentUser.password) : null;
      const isAdmin = currentUser && currentUser.username === "latifking" && currentUser.password === "ding2010";

      if (!found && !isAdmin) {
        window.location.href = "login.html";
      } else if (found && !found.approved) {
        window.location.href = "not-approved.html";
      }

      // Agregar botón de cierre de sesión
      const logoutBtn = document.createElement('div');
      logoutBtn.style.position = 'fixed';
      logoutBtn.style.top = '20px';
      logoutBtn.style.left = '20px';
      logoutBtn.style.zIndex = '999';
      logoutBtn.innerHTML = `
        <button onclick="logoutUser()" class="px-4 py-2 bg-gradient-to-r from-red-600 to-red-700 text-white rounded-lg shadow-lg font-bold cursor-pointer hover:from-red-700 hover:to-red-800 transition-all">
          <i class="fas fa-sign-out-alt ml-1"></i>
          تسجيل الخروج
        </button>
      `;
      document.body.appendChild(logoutBtn);

      // Verificar modo de tema oscuro
      if (localStorage.getItem('color-theme') === 'dark' || 
          (!localStorage.getItem('color-theme') && 
           window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      }
      
      // Configurar manejadores de eventos
      setupEventListeners();
      
      // Cargar archivos
      loadFiles();
    });
</script>
    <div style="position: fixed; top: 10px; right: 10px;">
  <span id="user-role" style="margin-right: 20px;"></span>
  <a href="/logout" style="text-decoration: none; color: white; background: #c00;
    padding: 5px 10px; border-radius: 5px;">🚪 Logout</a>
</div>
<script>
  fetch('/auth/user')
    .then(res => res.json())
    .then(data => {
      if (data.username) {
        document.getElementById('user-role').innerText = 
          `👤 ${data.username} (Role: ${data.role})`;
      }
    })
    .catch(() => {});
</script>
</body>
</html>
